<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>èˆ¹èˆ¶ç®¡ç†é©¾é©¶èˆ±</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        body { background: #f0f2f5; padding: 20px; font-family: "Helvetica Neue",Helvetica,"PingFang SC",Arial,sans-serif; }
        .title { margin-bottom: 20px; color: #303133; font-weight: bold; border-left: 5px solid #409EFF; padding-left: 10px; }
        .ship-container { display: flex; flex-wrap: wrap; }
        .ship-card { width: 280px; margin: 15px; cursor: pointer; transition: all 0.3s; position: relative; }
        .ship-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .add-card { border: 2px dashed #d9d9d9; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; height: 180px; background: white; cursor: pointer; border-radius: 4px; transition: all 0.3s; }
        .add-card:hover { border-color: #409EFF; color: #409EFF; }

        .card-content { text-align: center; padding: 20px; position: relative; }
        .big-icon { font-size: 50px; margin-bottom: 15px; color: #409EFF; }
        .ship-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; color: #303133; }
        .ship-info { color: #909399; font-size: 13px; margin-bottom: 10px; }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ */
        .del-btn { position: absolute; top: 10px; right: 10px; color: #F56C6C; display: none; padding: 5px; }
        .ship-card:hover .del-btn { display: block; }
    </style>
</head>
<body>
<div id="app">
    <h2 class="title">ğŸš¢ èˆ¹èˆ¶èµ„äº§ç®¡ç†ä¸­å¿ƒ</h2>

    <div class="ship-container">
        <div v-for="ship in ships" :key="ship.id" class="ship-card">
            <el-card :body-style="{ padding: '0px', height: '180px' }" shadow="hover">
                <div class="card-content" @click="enterShip(ship.id)">
                    <i class="el-icon-ship big-icon"></i>
                    <div class="ship-name">{{ ship.name || 'æœªå‘½å' }}</div>
                    <div class="ship-info">ID: {{ ship.id }} | èˆ·å·: {{ ship.code }}</div>
                    <el-tag size="mini" type="success" effect="dark">è¿è¥ä¸­</el-tag>
                </div>
                <el-button class="del-btn" icon="el-icon-delete" type="text" @click.stop="deleteShip(ship)"></el-button>
            </el-card>
        </div>

        <div class="add-card" @click="dialogVisible = true" style="width: 280px; margin: 15px;">
            <i class="el-icon-plus" style="font-size: 40px; margin-bottom: 10px;"></i>
            <div>æ³¨å†Œæ–°èˆ¹èˆ¶</div>
        </div>
    </div>

    <el-dialog title="æ³¨å†Œæ–°èˆ¹èˆ¶" :visible.sync="dialogVisible" width="400px">
        <el-form :model="form" label-width="80px">
            <el-form-item label="èˆ¹å" required><el-input v-model="form.name" placeholder="ä¾‹å¦‚ï¼šå±±ä¸œå·"></el-input></el-form-item>
            <el-form-item label="èˆ·å·" required><el-input v-model="form.code" placeholder="ä¾‹å¦‚ï¼šCV-17"></el-input></el-form-item>
            <el-form-item label="èˆ¹ä¸œ"><el-input v-model="form.owner"></el-input></el-form-item>
        </el-form>
        <div slot="footer">
            <el-button @click="dialogVisible = false">å–æ¶ˆ</el-button>
            <el-button type="primary" @click="createShip">ç«‹å³æ³¨å†Œ</el-button>
        </div>
    </el-dialog>
</div>

<script src="https://unpkg.com/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            ships: [],
            dialogVisible: false,
            form: { name: '', code: '', owner: '' }
        },
        mounted() { this.loadShips(); },
        methods: {
            loadShips() {
                axios.get('/api/ships').then(res => {
                    // è¿‡æ»¤æ‰æ²¡æœ‰IDçš„è„æ•°æ® (å‰ç«¯å…œåº•)
                    this.ships = res.data.filter(s => s.id != null);
                });
            },
            createShip() {
                if(!this.form.name || !this.form.code) {
                    this.$message.warning('è¯·å¡«å†™èˆ¹åå’Œèˆ·å·');
                    return;
                }
                axios.post('/api/ships', this.form).then(() => {
                    this.$message.success('æ³¨å†ŒæˆåŠŸ');
                    this.dialogVisible = false;
                    this.form = { name: '', code: '', owner: '' }; // æ¸…ç©ºè¡¨å•
                    this.loadShips();
                });
            },
            deleteShip(ship) {
                this.$confirm(`ç¡®å®šè¦åˆ é™¤ [${ship.name}] åŠå…¶æ‰€æœ‰æ•°æ®å—ï¼Ÿ`, 'è­¦å‘Š', {
                    confirmButtonText: 'ç¡®å®šåˆ é™¤',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'warning'
                }).then(() => {
                    axios.delete(`/api/ships/${ship.id}`).then(() => {
                        this.$message.success('åˆ é™¤æˆåŠŸ');
                        this.loadShips();
                    });
                });
            },
            enterShip(id) {
                // è·³è½¬
                window.location.href = `index.html?shipId=${id}`;
            }
        }
    })
</script>
</body>
</html>